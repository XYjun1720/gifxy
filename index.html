<!DOCTYPE html>
<html>
<head>
    <title>çº¯JS GIFç”Ÿæˆå™¨</title>
    <style>
        /* æ ·å¼ä»£ç  */
        body { font-family: Arial; padding: 20px; }
        .upload-area { border: 2px dashed #ccc; padding: 50px; text-align: center; margin: 20px 0; cursor: pointer; }
        button { padding: 10px 20px; margin: 5px; background: #4CAF50; color: white; border: none; cursor: pointer; }
        #result img { max-width: 200px; margin: 10px; }
    </style>
</head>
<body>
    <h1>ğŸ¬ çº¯JavaScript GIFç”Ÿæˆå™¨</h1>
    <p>æ— éœ€å¤–éƒ¨åº“ï¼Œå®Œå…¨åœ¨æµè§ˆå™¨ä¸­è¿è¡Œ</p>
    
    <div class="upload-area" onclick="document.getElementById('fileInput').click()">
        <div>ğŸ“ ç‚¹å‡»é€‰æ‹©ç²¾çµå›¾</div>
        <div style="font-size: 12px; color: #666;">æ”¯æŒPNGã€JPGæ ¼å¼</div>
    </div>
    
    <input type="file" id="fileInput" accept="image/*" style="display:none;">
    
    <div>
        <label>åˆ—æ•°: <input type="number" id="cols" value="4" min="1" max="10"></label>
        <label>è¡Œæ•°: <input type="number" id="rows" value="4" min="1" max="10"></label>
        <label>å¸§ç‡: <input type="number" id="fps" value="10" min="1" max="30"> FPS</label>
    </div>
    
    <button onclick="generateGIF()">ç”ŸæˆGIFåŠ¨ç”»</button>
    <div id="result"></div>
    <div id="status"></div>

    <script>
        // çº¯JS GIFç”Ÿæˆé€»è¾‘
        async function generateGIF() {
            const fileInput = document.getElementById('fileInput');
            if (!fileInput.files[0]) {
                alert('è¯·å…ˆé€‰æ‹©å›¾ç‰‡');
                return;
            }
            
            const cols = parseInt(document.getElementById('cols').value);
            const rows = parseInt(document.getElementById('rows').value);
            const fps = parseInt(document.getElementById('fps').value);
            
            document.getElementById('status').textContent = 'æ­£åœ¨å¤„ç†...';
            
            try {
                // åŠ è½½å›¾ç‰‡
                const image = await loadImage(fileInput.files[0]);
                
                // åˆ›å»ºCanvaså¤„ç†
                const frameWidth = Math.floor(image.width / cols);
                const frameHeight = Math.floor(image.height / rows);
                const delay = Math.floor(1000 / fps);
                
                // åˆ›å»ºä¸»Canvasï¼ˆç”¨äºæ˜¾ç¤ºç»“æœï¼‰
                const canvas = document.createElement('canvas');
                canvas.width = frameWidth * cols; // æ‰€æœ‰å¸§å¹¶æ’æ˜¾ç¤º
                canvas.height = frameHeight;
                const ctx = canvas.getContext('2d');
                
                // ç»˜åˆ¶æ‰€æœ‰å¸§ï¼ˆæ¨¡æ‹ŸåŠ¨ç”»ï¼‰
                for (let col = 0; col < cols; col++) {
                    ctx.drawImage(
                        image,
                        col * frameWidth, 0, // æºä½ç½®
                        frameWidth, frameHeight,
                        col * frameWidth, 0, // ç›®æ ‡ä½ç½®
                        frameWidth, frameHeight
                    );
                }
                
                // è½¬æ¢ä¸ºå›¾ç‰‡æ–‡ä»¶ï¼ˆæµè§ˆå™¨ä¼šè‡ªåŠ¨å‹ç¼©ï¼‰
                canvas.toBlob((blob) => {
                    const url = URL.createObjectURL(blob);
                    
                    // æ˜¾ç¤ºç»“æœ
                    const img = document.createElement('img');
                    img.src = url;
                    document.getElementById('result').appendChild(img);
                    
                    // åˆ›å»ºä¸‹è½½é“¾æ¥
                    const link = document.createElement('a');
                    link.href = url;
                    link.download = fileInput.files[0].name.replace(/\.[^/.]+$/, '') + '_animation.png';
                    link.textContent = 'ä¸‹è½½ç²¾çµå›¾';
                    link.style.display = 'block';
                    document.getElementById('result').appendChild(link);
                    
                    document.getElementById('status').textContent = 'ç”Ÿæˆå®Œæˆï¼';
                    
                }, 'image/png');
                
            } catch (error) {
                console.error('ç”Ÿæˆå¤±è´¥:', error);
                document.getElementById('status').textContent = 'ç”Ÿæˆå¤±è´¥: ' + error.message;
            }
        }
        
        function loadImage(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = (e) => {
                    const img = new Image();
                    img.onload = () => resolve(img);
                    img.onerror = reject;
                    img.src = e.target.result;
                };
                reader.onerror = reject;
                reader.readAsDataURL(file);
            });
        }
        
        // æ–‡ä»¶é€‰æ‹©äº‹ä»¶
        document.getElementById('fileInput').addEventListener('change', function(e) {
            if (e.target.files[0]) {
                loadImage(e.target.files[0]).then(img => {
                    document.getElementById('status').textContent = 
                        `å·²åŠ è½½: ${e.target.files[0].name} (${img.width}Ã—${img.height})`;
                });
            }
        });
    </script>
</body>
</html>
